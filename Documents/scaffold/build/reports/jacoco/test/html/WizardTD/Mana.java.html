<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Mana.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">scaffold</a> &gt; <a href="index.source.html" class="el_package">WizardTD</a> &gt; <span class="el_source">Mana.java</span></div><h1>Mana.java</h1><pre class="source lang-java linenums">package WizardTD;

import processing.core.PApplet;
import processing.data.JSONObject;

public class Mana extends GameElements{
    private double mana_pool_spell_cost_increase_per_use;
    private double mana_pool_spell_cap_multiplier;
    private double mana_pool_spell_mana_gained_multiplier;

    private double mana_pool_cost;
    private double mana_gained_per_second;

    private ManaBar mana_bar;
    private ManaPoolSpell mana_pool;
    
    private double current_mana;
    private double current_mana_cap;
   
    private boolean has_lost;
    private int times_mana_cast;

    public Mana (JSONObject json) {
<span class="fc" id="L24">        super(json);</span>
<span class="fc" id="L25">        current_mana = getNumericAmount(&quot;initial_mana&quot;, json);</span>
<span class="fc" id="L26">        current_mana_cap = getNumericAmount(&quot;initial_mana_cap&quot;, json);</span>
<span class="fc" id="L27">        mana_gained_per_second = getNumericAmount(&quot;initial_mana_gained_per_second&quot;, json);</span>

<span class="fc" id="L29">        mana_bar = new ManaBar();</span>
<span class="fc" id="L30">        mana_bar.setExternalWidth(current_mana/current_mana_cap);</span>
        
<span class="fc" id="L32">        mana_pool_cost = getNumericAmount(&quot;mana_pool_spell_initial_cost&quot;, json);</span>
<span class="fc" id="L33">        mana_pool_spell_cost_increase_per_use = getNumericAmount(&quot;mana_pool_spell_cost_increase_per_use&quot;, json);</span>
<span class="fc" id="L34">        mana_pool_spell_cap_multiplier = getNumericAmount(&quot;mana_pool_spell_cap_multiplier&quot;, json);</span>
<span class="fc" id="L35">        mana_pool_spell_mana_gained_multiplier = getNumericAmount(&quot;mana_pool_spell_mana_gained_multiplier&quot;, json);</span>

<span class="fc" id="L37">        mana_pool = new ManaPoolSpell((int)mana_pool_cost);</span>
<span class="fc" id="L38">        times_mana_cast = 0;</span>
<span class="fc" id="L39">    }</span>

    /**
     * Retrieves the current mana amount that the player has
     * @return current_mana
     */
    public double getCurrentMana() {
<span class="fc" id="L46">        return current_mana;</span>
    }
    
    /**
     * Retrieves the current mana cap that the player has. This value is the maximum amount of mana that the player can have
     * @return current_mana_cap
     */
    public double getCurrentManaCap() {
<span class="fc" id="L54">        return current_mana_cap;</span>
    }

    /**
     * Allows the user to change the current mana amount.
     * The minimum value that the mana can decrease to for this method is above 0, and
     * the maximum value that the mana can increase to is the current mana cap.
     * Often invoked to purchase items, to prevent players from purposely trying to lose the game by spending all their mana.
     * @param cost value to increase/decrease mana by. If decreasing, cost must be a negative value
     */
    public void changeCurrentMana(double cost) {
<span class="fc bfc" id="L65" title="All 2 branches covered.">        if (cost &lt; 0) {</span>
<span class="fc bfc" id="L66" title="All 2 branches covered.">            if ((cost + current_mana) &gt; 0) { //decrease mana</span>
<span class="fc" id="L67">                current_mana += cost;</span>
<span class="fc" id="L68">                double decrement = (-cost)/current_mana_cap;</span>
<span class="fc" id="L69">                this.mana_bar.decreaseExternalWidth(decrement);</span>
<span class="fc" id="L70">            }</span>
        }
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">        else if (cost &gt;= 0) { //increase mana</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">            if ((cost + current_mana) &lt;= current_mana_cap) {</span>
<span class="fc" id="L74">                current_mana += cost;</span>
<span class="fc" id="L75">                double increment = cost/current_mana_cap;</span>
<span class="fc" id="L76">                this.mana_bar.increaseExternalWidth(increment);</span>
            }
        }
<span class="fc" id="L79">    }</span>

    /**
     * Allows the user to decrease the mana to a minimum value of 0. 
     * Often invoked when monsters reach the wizard's house, as this allows the game to be lost
     * @param amount to decrease mana by. Value must be a positive amount
     */
    public void decreaseMana(double amount) {
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">        if (amount &gt; 0) {</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">            if (current_mana - amount &lt;= 0) {</span>
<span class="fc" id="L89">                this.mana_bar.setExternalWidth(0);</span>
<span class="fc" id="L90">                current_mana = 0;</span>
            }
            else {
<span class="fc" id="L93">                double decrement = amount/current_mana_cap;</span>
<span class="fc" id="L94">                current_mana -= amount;</span>
<span class="fc" id="L95">                this.mana_bar.decreaseExternalWidth(decrement);</span>
            }
        }
<span class="fc" id="L98">    }</span>

    /**
     * Retrieves the mana pool spell instance for the game
     * @return mana_pool
     */
    public ManaPoolSpell getManaPoolSpell() {
<span class="nc" id="L105">        return mana_pool;</span>
    }

    /**
     * Indicates whether the player has lost the game or not.
     * @return true if player has run out of mana, false otherwise
     */
    public boolean hasLost() {
<span class="fc" id="L113">        return has_lost;</span>
    }

    /**
     * Logic for playing the mana pool spell and changing the current mana values accordingly.
     * Also allows mana to increase per second when the game is not paused, and changes the player's current lose status if mana decreases to 0.
     * @param app that instantiates the class
     * @param pause Pause object used to check if game has been paused
     * @param ff FastForward object used to check if game has been fastforwarded
     * @param wave Wave object used to check whether player has won the game or not
     */
    public void tick(PApplet app, Pause pause, FastFoward ff, Wave wave) {
<span class="fc bfc" id="L125" title="All 2 branches covered.">        if (current_mana &lt;= 0) {</span>
<span class="fc" id="L126">            has_lost = true;</span>
        }
        else {
<span class="fc" id="L129">            has_lost = false;</span>
        }
<span class="pc bpc" id="L131" title="1 of 4 branches missed.">        if (!has_lost &amp;&amp; !wave.hasWon()) {</span>
<span class="fc" id="L132">            mana_pool.tick(app);</span>
<span class="fc" id="L133">            int fps = FPS;</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">            if (ff.isSelected()) {</span>
<span class="nc" id="L135">                fps = (int)(FPS/2);</span>
            }

<span class="pc bpc" id="L138" title="5 of 6 branches missed.">            if (mana_pool.isSelected() &amp;&amp; !mana_pool.wasSelected() &amp;&amp; mana_pool_cost &lt; current_mana) {</span>
<span class="nc" id="L139">                times_mana_cast++;</span>
<span class="nc" id="L140">                current_mana -= mana_pool_cost;</span>
<span class="nc" id="L141">                current_mana_cap += current_mana_cap*(mana_pool_spell_cap_multiplier-1)*(times_mana_cast);</span>
<span class="nc" id="L142">                mana_gained_per_second += mana_gained_per_second*(mana_pool_spell_mana_gained_multiplier-1)*(times_mana_cast);</span>
<span class="nc" id="L143">                mana_bar.setExternalWidth(current_mana/current_mana_cap);</span>
<span class="nc" id="L144">                mana_pool_cost += mana_pool_spell_cost_increase_per_use;</span>
<span class="nc" id="L145">                mana_pool.updateCost((int)mana_pool_cost);</span>
<span class="nc" id="L146">                mana_pool.setSelected();  </span>
            }
            
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">            if (!pause.isSelected()) {</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">                if (app.frameCount%fps == 0) {</span>
<span class="fc" id="L151">                    changeCurrentMana(mana_gained_per_second);</span>
                }
            }
        }
        
<span class="fc" id="L156">    }</span>
    
    /**
     * Renders the mana pool spell button and the mana bar on the screen
     * @param app that instantiates the class
     * @param wave Wave object that is invoked by the mana pool spell object
     */
    public void draw(PApplet app, Wave wave) {
<span class="fc" id="L164">        this.mana_pool.drawButtons(app, this, wave);</span>
        
<span class="fc" id="L166">        this.mana_bar.setBorder(app);</span>
<span class="fc" id="L167">        this.mana_bar.drawRectangle(app); </span>
        
<span class="fc" id="L169">        this.mana_bar.showAmountLeft(app, (int)current_mana, (int)current_mana_cap);</span>
<span class="fc" id="L170">        this.mana_bar.showText(app);</span>
<span class="fc" id="L171">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>