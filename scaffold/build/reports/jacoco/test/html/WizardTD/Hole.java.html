<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Hole.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">scaffold</a> &gt; <a href="index.source.html" class="el_package">WizardTD</a> &gt; <span class="el_source">Hole.java</span></div><h1>Hole.java</h1><pre class="source lang-java linenums">package WizardTD;
import processing.core.PApplet;
import processing.core.PImage;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
public class Hole extends GameplayActions {
    public static final int HOLE_COST = 100;
    public static final int HOLE_WAIT = 5;
<span class="fc" id="L10">    public static final int[] DESELECT = {62,71,114};</span>

    private PImage hole;
    private ArrayList&lt;int[]&gt; path_tiles_coords;
    private int[] test;
    private ArrayList&lt;int[]&gt; holes_to_remove;
    private HashMap&lt;int[], PImage&gt; holes_placed;
    private boolean hole_placed;
    private int count;
    private Shape cost_show;
    private int current_cost;

    public Hole(PImage hole, Board board) {
<span class="fc" id="L23">        super(412, 'h', &quot;H &quot;, &quot;Hole\ntrap&quot;);</span>
<span class="fc" id="L24">        this.hole = hole;</span>
<span class="fc" id="L25">        test = new int[2];</span>
<span class="fc" id="L26">        this.path_tiles_coords = board.getPathTiles();</span>
<span class="fc" id="L27">        holes_to_remove = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L28">        holes_placed = new HashMap&lt;&gt;();</span>
<span class="fc" id="L29">        hole_placed = false;</span>

<span class="fc" id="L31">        cost_show = new Shape(585, y + 2, 52, 18, COSTBOX, COSTBOX);</span>
<span class="fc" id="L32">        current_cost = HOLE_COST;</span>
<span class="fc" id="L33">    }</span>

    /**
     * Retrieves the current cost of purchasing a hole
     * @return current_cost
     */
    public int getHoleCost() {
<span class="fc" id="L40">        return current_cost;</span>
    }

    public HashMap&lt;int[], PImage&gt; getHolesPurchased() {
<span class="fc" id="L44">        return holes_placed;</span>
    }

    /**
     * Renders a cross on top of the button when hole_placed is true to signify that the player cannot purchase a hole at the current time
     * @param app that instantiates this class
     */
    public void deselect(PApplet app) {
<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (hole_placed) {</span>
<span class="fc" id="L53">            app.strokeWeight(3);</span>
<span class="fc" id="L54">            app.stroke(DESELECT[0], DESELECT[1], DESELECT[2]);</span>
<span class="fc" id="L55">            app.line(x, y, x + DIMENSION, y + DIMENSION);</span>
<span class="fc" id="L56">            app.line(x, y+DIMENSION, x + DIMENSION, y);</span>
        }  
<span class="fc" id="L58">    }</span>

    /**
     * Checks if the current mouse coordinates are contained within a location of provided within a Collection of x,y coordinates.
     * Used to verify whether the mouse was clicked over a path tile or a purchased hole tile. If true, test is set to these coordinates.
     * @param app that insantiates the class
     * @param all_coords the Collection of int arrays containing 2 elements which correspond to x,y coordinates on the screen
     * @return true if mouse was clicked over valid tile, false otherwise
     */
    public boolean checkMouse(PApplet app, Collection&lt;int[]&gt; all_coords) {
<span class="fc bfc" id="L68" title="All 2 branches covered.">        for (int[] coords : all_coords) {</span>
<span class="pc bpc" id="L69" title="2 of 10 branches missed.">            if (mouseClicked &amp;&amp; (app.mouseX &gt;= coords[0] &amp;&amp; app.mouseX &lt;= (coords[0] + WaveElements.PIXELSPERTILE)) &amp;&amp; (app.mouseY &gt;= coords[1] &amp;&amp; app.mouseY &lt;= (coords[1] + WaveElements.PIXELSPERTILE))) {</span>
<span class="fc" id="L70">                test = coords;</span>
<span class="fc" id="L71">                return true;  </span>
            }
<span class="fc" id="L73">        }</span>
<span class="fc" id="L74">        return false;</span>
    }

    /**
     * Logic for checking if the user has selected the button and clicked their mouse over a valid path tile, in order to make a hole purchase.
     * If a hole is purchased, this method checks if 5 seconds have passed, to signify that the user can purchase another hole, however the cost will increase every use
     * @param app that instantiates this class
     * @param mana Mana object used to check if game has been lost yet
     * @param wave Wave object used to chekc if game has been won and retrieve spawned monsters to kill
     */
    public void tick(PApplet app, Mana mana, Wave wave, FastForward ff) {
<span class="pc bpc" id="L85" title="1 of 4 branches missed.">        if (!mana.hasLost() &amp;&amp; !wave.hasWon()) {</span>
<span class="fc" id="L86">            int fps = WaveElements.FPS;</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            if (ff.isSelected()) {</span>
<span class="fc" id="L88">                fps = WaveElements.FPS/2;</span>
            }
<span class="fc bfc" id="L90" title="All 4 branches covered.">            if (hole_placed &amp;&amp; app.frameCount%fps == 0) {</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">                if (count &lt; HOLE_WAIT) { //if less than five seconds after hole purchased</span>
<span class="fc" id="L92">                    count++;</span>
                }
                else { // increase cost
<span class="fc" id="L95">                    hole_placed = false;</span>
<span class="fc" id="L96">                    cost_show.setExternalColour(COSTBOX);</span>
<span class="fc" id="L97">                    current_cost += HOLE_COST;</span>
                }
            }
<span class="pc bpc" id="L100" title="3 of 8 branches missed.">            else if (selected &amp;&amp; !hole_placed &amp;&amp; checkMouse(app, path_tiles_coords) &amp;&amp; !checkMouse(app, holes_placed.keySet())) { //if button selected, and mouse is clicked over valid tile and user has waited at least 5 seconds after previous purchase</span>
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">                if (mana.getCurrentMana() &gt; current_cost) {</span>
<span class="fc" id="L102">                    holes_placed.put(test, hole.get());</span>
<span class="fc" id="L103">                    mana.changeCurrentMana(-current_cost); //reduce mana</span>
<span class="fc" id="L104">                    hole_placed = true;</span>
<span class="fc" id="L105">                    count = 0; //reset count so player has to wait another 5 seconds</span>
<span class="fc" id="L106">                    cost_show.setExternalColour(DESELECT);</span>
                }
            }
            
<span class="fc bfc" id="L110" title="All 2 branches covered.">            for (Monsters current : wave.getSpawnedMonsters()) {</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">                for (int[] coords : holes_placed.keySet()) {</span>
<span class="pc bpc" id="L112" title="1 of 4 branches missed.">                    if ((coords[0] == (int)(current.getX() - Monsters.OFFSET)) &amp;&amp; (coords[1] == (int)(current.getY() - Monsters.OFFSET))) {</span>
<span class="fc" id="L113">                        mana.changeCurrentMana(current.getManaGained()*mana.getManaMultiplier()); //kill monster if in the middle of the hole</span>
<span class="fc" id="L114">                        current.kill();</span>
<span class="fc" id="L115">                        holes_to_remove.add(coords);</span>
                    }
<span class="fc" id="L117">                }</span>
<span class="fc" id="L118">            }</span>
<span class="fc" id="L119">            showCost(app, cost_show, current_cost);</span>

<span class="fc bfc" id="L121" title="All 2 branches covered.">        for (int[] remove : holes_to_remove) {</span>
<span class="fc" id="L122">            holes_placed.remove(remove, holes_placed.get(remove)); //remove purchased holes when monster falls into it</span>
<span class="fc" id="L123">        }</span>
    }     
    
<span class="fc" id="L126">    }</span>

    /**
     * Renders purchased holes on screen in correct position
     * @param app that instantiates this class
     */
    public void draw(PApplet app) {
<span class="fc bfc" id="L133" title="All 2 branches covered.">        for (int[] current : holes_placed.keySet()) {</span>
<span class="fc" id="L134">            app.image(holes_placed.get(current), current[0], current[1]);</span>
<span class="fc" id="L135">        }</span>
<span class="fc" id="L136">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>