<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Mana.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">scaffold</a> &gt; <a href="index.source.html" class="el_package">WizardTD</a> &gt; <span class="el_source">Mana.java</span></div><h1>Mana.java</h1><pre class="source lang-java linenums">package WizardTD;

import processing.core.PApplet;
import processing.data.JSONObject;

public class Mana implements RetrieveValues{
    private double mana_pool_spell_cost_increase_per_use;
    private double mana_pool_spell_cap_multiplier;
    private double mana_pool_spell_mana_gained_multiplier;
    private double mana_gained_per_kill_multiplier;

    private double mana_pool_cost;
    private double mana_gained_per_second;

    private ManaBar mana_bar;
    private ManaPoolSpell mana_pool;
    
    private double current_mana;
    private double current_mana_cap;
   
    private boolean has_lost;
    private int times_mana_cast;

<span class="fc" id="L24">    public Mana (JSONObject json) {</span>
<span class="fc" id="L25">        current_mana = getNumericAmount(&quot;initial_mana&quot;, json);</span>
<span class="fc" id="L26">        current_mana_cap = getNumericAmount(&quot;initial_mana_cap&quot;, json);</span>
<span class="fc" id="L27">        mana_gained_per_second = getNumericAmount(&quot;initial_mana_gained_per_second&quot;, json);</span>
<span class="fc" id="L28">        mana_gained_per_kill_multiplier = 1;</span>

<span class="fc" id="L30">        mana_bar = new ManaBar();</span>
<span class="fc" id="L31">        mana_bar.setExternalWidth(current_mana/current_mana_cap);</span>
        
<span class="fc" id="L33">        mana_pool_cost = getNumericAmount(&quot;mana_pool_spell_initial_cost&quot;, json);</span>
<span class="fc" id="L34">        mana_pool_spell_cost_increase_per_use = getNumericAmount(&quot;mana_pool_spell_cost_increase_per_use&quot;, json);</span>
<span class="fc" id="L35">        mana_pool_spell_cap_multiplier = getNumericAmount(&quot;mana_pool_spell_cap_multiplier&quot;, json);</span>
<span class="fc" id="L36">        mana_pool_spell_mana_gained_multiplier = getNumericAmount(&quot;mana_pool_spell_mana_gained_multiplier&quot;, json);</span>

<span class="fc" id="L38">        mana_pool = new ManaPoolSpell((int)mana_pool_cost);</span>
<span class="fc" id="L39">        times_mana_cast = 0;</span>
<span class="fc" id="L40">    }</span>

    /**
     * Retrieves the current mana amount that the player has
     * @return current_mana
     */
    public double getCurrentMana() {
<span class="fc" id="L47">        return current_mana;</span>
    }
    
    /**
     * Retrieves the current mana cap that the player has. This value is the maximum amount of mana that the player can have
     * @return current_mana_cap
     */
    public double getCurrentManaCap() {
<span class="fc" id="L55">        return current_mana_cap;</span>
    }

    /**
     * Retrieves the current multiplier applied to mana gained on kill, the value of which increases after a mana pool spell purchase
     * @return mana_gained_per_kill_multiplier
     */
    public double getManaMultiplier() {
<span class="fc" id="L63">        return mana_gained_per_kill_multiplier;</span>
    }

    /**
     * Allows the user to change the current mana amount.
     * The minimum value that the mana can decrease to for this method is above 0, and
     * the maximum value that the mana can increase to is the current mana cap.
     * Often invoked to purchase items, to prevent players from purposely trying to lose the game by spending all their mana.
     * @param cost value to increase/decrease mana by. If decreasing, cost must be a negative value
     */
    public void changeCurrentMana(double cost) {
<span class="fc bfc" id="L74" title="All 2 branches covered.">        if (cost &lt; 0) {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">            if ((cost + current_mana) &gt; 0) { //decrease mana</span>
<span class="fc" id="L76">                current_mana += cost;</span>
<span class="fc" id="L77">                double decrement = (-cost)/current_mana_cap;</span>
<span class="fc" id="L78">                this.mana_bar.decreaseExternalWidth(decrement);</span>
<span class="fc" id="L79">            }</span>
        }
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">        else if (cost &gt;= 0) { //increase mana</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">            if ((cost + current_mana) &lt;= current_mana_cap) {</span>
<span class="fc" id="L83">                current_mana += cost;</span>
<span class="fc" id="L84">                double increment = cost/current_mana_cap;</span>
<span class="fc" id="L85">                this.mana_bar.increaseExternalWidth(increment);</span>
            }
        }
<span class="fc" id="L88">    }</span>

    /**
     * Allows the user to decrease the mana to a minimum value of 0. 
     * Often invoked when monsters reach the wizard's house, as this allows the game to be lost
     * @param amount to decrease mana by. Value must be a positive amount
     */
    public void decreaseMana(double amount) {
<span class="pc bpc" id="L96" title="1 of 2 branches missed.">        if (amount &gt; 0) {</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">            if (current_mana - amount &lt;= 0) {</span>
<span class="fc" id="L98">                this.mana_bar.setExternalWidth(0);</span>
<span class="fc" id="L99">                current_mana = 0;</span>
            }
            else {
<span class="fc" id="L102">                double decrement = amount/current_mana_cap;</span>
<span class="fc" id="L103">                current_mana -= amount;</span>
<span class="fc" id="L104">                this.mana_bar.decreaseExternalWidth(decrement);</span>
            }
        }
<span class="fc" id="L107">    }</span>

    /**
     * Retrieves the mana pool spell instance for the game
     * @return mana_pool
     */
    public ManaPoolSpell getManaPoolSpell() {
<span class="fc" id="L114">        return mana_pool;</span>
    }

    /**
     * Indicates whether the player has lost the game or not.
     * @return true if player has run out of mana, false otherwise
     */
    public boolean hasLost() {
<span class="fc" id="L122">        return has_lost;</span>
    }

    /**
     * Logic for playing the mana pool spell and changing the current mana values accordingly.
     * Also allows mana to increase per second when the game is not paused, and changes the player's current lose status if mana decreases to 0.
     * @param app that instantiates the class
     * @param pause Pause object used to check if game has been paused
     * @param ff FastForward object used to check if game has been fastforwarded
     * @param wave Wave object used to check whether player has won the game or not
     */
    public void tick(PApplet app, Pause pause, FastForward ff, Wave wave) {
<span class="fc bfc" id="L134" title="All 2 branches covered.">        if (current_mana &lt;= 0) {</span>
<span class="fc" id="L135">            has_lost = true; //player loses when mana is 0</span>
        }
        else {
<span class="fc" id="L138">            has_lost = false;</span>
        }
<span class="pc bpc" id="L140" title="1 of 4 branches missed.">        if (!has_lost &amp;&amp; !wave.hasWon()) {</span>
<span class="fc" id="L141">            mana_pool.tick(app);</span>
<span class="fc" id="L142">            int fps = WaveElements.FPS;</span>
<span class="fc bfc" id="L143" title="All 2 branches covered.">            if (ff.isSelected()) {</span>
<span class="fc" id="L144">                fps = (int)(WaveElements.FPS/2);</span>
            }

<span class="pc bpc" id="L147" title="2 of 6 branches missed.">            if (mana_pool.isSelected() &amp;&amp; !mana_pool.wasSelected() &amp;&amp; mana_pool_cost &lt; current_mana) { //increase mana cap and mana gained</span>
<span class="fc" id="L148">                times_mana_cast++;</span>
<span class="fc" id="L149">                current_mana -= mana_pool_cost;</span>
                
<span class="fc" id="L151">                current_mana_cap += current_mana_cap*(mana_pool_spell_cap_multiplier-1)*(times_mana_cast);</span>
<span class="fc" id="L152">                mana_gained_per_second += mana_gained_per_second*(mana_pool_spell_mana_gained_multiplier-1)*(times_mana_cast);</span>
<span class="fc" id="L153">                mana_gained_per_kill_multiplier += (mana_pool_spell_mana_gained_multiplier-1)*(times_mana_cast);</span>
                
<span class="fc" id="L155">                mana_bar.setExternalWidth(current_mana/current_mana_cap);</span>
<span class="fc" id="L156">                mana_pool_cost += mana_pool_spell_cost_increase_per_use;</span>
<span class="fc" id="L157">                mana_pool.updateCost((int)mana_pool_cost);</span>
<span class="fc" id="L158">                mana_pool.setSelected();  </span>
            }
            
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">            if (!pause.isSelected()) {</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">                if (app.frameCount%fps == 0) {</span>
<span class="fc" id="L163">                    changeCurrentMana(mana_gained_per_second);</span>
                }
            }
        }
        
<span class="fc" id="L168">    }</span>
    
    /**
     * Renders the mana pool spell button and the mana bar on the screen
     * @param app that instantiates the class
     * @param wave Wave object that is invoked by the mana pool spell object
     */
    public void draw(PApplet app, Wave wave) {
<span class="fc" id="L176">        this.mana_pool.drawButtons(app, this, wave);</span>
        
<span class="fc" id="L178">        this.mana_bar.setBorder(app);</span>
<span class="fc" id="L179">        this.mana_bar.drawRectangle(app); </span>
        
<span class="fc" id="L181">        this.mana_bar.showAmountLeft(app, (int)current_mana, (int)current_mana_cap);</span>
<span class="fc" id="L182">        this.mana_bar.showText(app);</span>
<span class="fc" id="L183">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>